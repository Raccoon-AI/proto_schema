syntax = "proto2";
package raccoonai;

import "job.proto";
import "route.proto";

option go_package = "./pb";

message AIDispatcherRequest {
  required uint64 service_provider_id = 1 [json_name = "service_provider_id"];
}

message AssignmentResponse {
  required RouteCreate route = 1 [json_name = "route"];
  repeated JobUpdate jobs = 2 [json_name = "jobs"];
}

message BulkAssignmentResponse {
  repeated AssignmentResponse responses = 1 [json_name = "responses"];
}

enum CapacityPlanResponseStatus {
  CAPACITY_PLAN_RESPONSE_STATUS_UNDEFINED = 0;
  CAPACITY_PLAN_RESPONSE_STATUS_OK = 1;
  CAPACITY_PLAN_RESPONSE_STATUS_INVALID_INPUT = 2;
  CAPACITY_PLAN_RESPONSE_STATUS_INTERNAL_ERROR = 3;
}

message CapacityPlanResponse {
  required CapacityPlanResponseStatus status = 1 [json_name = "status"];
  required uint64 num_existing_jobs = 2 [json_name = "num_existing_jobs"];
  required uint64 num_expected_jobs = 3 [json_name = "num_expected_jobs"];
  required uint64 num_drivers_minimum = 4 [json_name = "num_drivers_minimum"];

  optional string error_message = 5 [json_name = "error_message"];
  optional string info_json = 8 [json_name = "info_json"];
}

service AIDispatcherV4 {
  rpc OnDispatcherHeartbeat(AIDispatcherRequest) returns (BulkAssignmentResponse);
  rpc OnCapacityPlan(AIDispatcherRequest) returns (CapacityPlanResponse);
}
