syntax = "proto2";
package raccoonai;

import "driver_on_shift.proto";
import "google/protobuf/struct.proto";
import "google/protobuf/timestamp.proto";
import "organization.proto";
import "pickup_location.proto";
import "user.proto";

option go_package = "./pb";

enum JobType {
  JOB_TYPE_UNDEFINED = 0;
  JOB_TYPE_SERVICE = 1;
  JOB_TYPE_ADD_BUNKER = 2;
  JOB_TYPE_REMOVE_BUNKER = 3;
  JOB_TYPE_MSW = 4; // Municipal Solid Waste
}

enum JobStatus {
  JOB_STATUS_UNDEFINED = 0;
  JOB_STATUS_CREATED = 1;
  JOB_STATUS_ASSIGNED = 2;
  JOB_STATUS_ENROUTE = 3;
  JOB_STATUS_COMPLETED = 4;
  JOB_STATUS_CANCELLED = 5;
  JOB_STATUS_ON_SERVICE = 6;
}

enum DispatcherReviewStatus {
  DISPATCHER_REVIEW_STATUS_UNDEFINED = 0;
  DISPATCHER_REVIEW_STATUS_PENDING = 1;
  DISPATCHER_REVIEW_STATUS_APPROVED = 2;
  DISPATCHER_REVIEW_STATUS_REJECTED = 3;
  DISPATCHER_REVIEW_STATUS_SUSPICIOUS = 4;
}

enum JobEvent {
  JOB_EVENT_UNDEFINED = 0;
  JOB_EVENT_CREATE_JOB = 1;
  JOB_EVENT_ASSIGN = 2;
  JOB_EVENT_FALLBACK_ASSIGN = 3;
  JOB_EVENT_ENROUTE = 4;
  JOB_EVENT_START_SERVICE = 5;
  JOB_EVENT_COMPLETE = 6;
  JOB_EVENT_CANCEL = 7;
  JOB_EVENT_DETACH_FROM_ROUTE = 8;
  JOB_EVENT_FORCE_COMPLETE = 9;
}

message JobEventIn {
  required JobEvent event = 1 [json_name = "event"];
  required uint64 job_id = 2 [json_name = "job_id"];
  optional google.protobuf.Struct payload = 3 [json_name = "payload"];
}

// GET => /v1/platform/job/{id}
message Job {
  required uint64 id = 1 [json_name = "id"];
  required google.protobuf.Timestamp created_at = 2 [json_name = "created_at"];
  required uint64 service_provider_id = 3 [json_name = "service_provider_id"];
  required uint64 service_receiver_id = 4 [json_name = "service_receiver_id"];
  optional google.protobuf.Timestamp tw_start_at = 5 [json_name = "tw_start_at"];
  optional google.protobuf.Timestamp tw_end_at = 6 [json_name = "tw_end_at"];
  optional uint64 step_idx = 7 [json_name = "step_idx"];
  required uint64 author_id = 8 [json_name = "author_id"];
  optional uint64 driver_on_shift_id = 9 [json_name = "driver_on_shift_id"];
  required uint64 pickup_location_id = 10 [json_name = "pickup_location_id"];
  optional string service_started_report_url = 11 [json_name = "service_started_report_url"];
  optional string service_ended_report_url = 12 [json_name = "service_ended_report_url"];
  optional uint64 route_id = 13 [json_name = "route_id"];
  optional string driver_comment = 14 [json_name = "driver_comment"];
  optional google.protobuf.Timestamp plan_start_at = 16 [json_name = "plan_start_at"];
  optional google.protobuf.Timestamp plan_end_at = 17 [json_name = "plan_end_at"];
  optional google.protobuf.Timestamp fact_start_at = 18 [json_name = "fact_start_at"];
  optional google.protobuf.Timestamp fact_end_at = 19 [json_name = "fact_end_at"];
  required JobStatus status = 20 [json_name = "status"];
  optional Organization service_receiver = 21 [json_name = "service_receiver"];
  optional PickupLocation pickup_location = 22 [json_name = "pickup_location"];
  optional DriverOnShift driver_on_shift = 23 [json_name = "driver_on_shift"];
  required JobType type = 24 [json_name = "type"];
  required DispatcherReviewStatus dispatcher_review_status = 25 [json_name = "dispatcher_review_status"];
  optional double service_start_photo_lat = 26 [json_name = "service_start_photo_lat"];
  optional double service_start_photo_lon = 27 [json_name = "service_start_photo_lon"];
  optional double service_end_photo_lat = 28 [json_name = "service_end_photo_lat"];
  optional double service_end_photo_lon = 29 [json_name = "service_end_photo_lon"];
  optional string container_name = 30 [json_name = "container_name"];
  optional uint64 job_tariff = 31 [json_name = "job_tariff"];
  optional bool is_pseudo = 32 [json_name = "is_pseudo"];
  optional google.protobuf.Timestamp gps_start_at = 33 [json_name = "gps_start_at"];
  optional google.protobuf.Timestamp gps_end_at = 34 [json_name = "gps_end_at"];
  optional bool is_created_by_client = 35 [json_name = "is_created_by_client"];
  optional uint64 scale_record_id = 36 [json_name = "scale_record_id"];
  optional User author = 37 [json_name = "author"];
}

message JobCreate {
  optional uint64 service_provider_id = 1 [json_name = "service_provider_id"];
  optional uint64 service_receiver_id = 2 [json_name = "service_receiver_id"];
  optional google.protobuf.Timestamp tw_start_at = 3 [json_name = "tw_start_at"];
  optional google.protobuf.Timestamp tw_end_at = 4 [json_name = "tw_end_at"];
  optional uint64 step_idx = 5 [json_name = "step_idx"];
  optional uint64 author_id = 6 [json_name = "author_id"];
  optional uint64 driver_on_shift_id = 7 [json_name = "driver_on_shift_id"];
  required uint64 pickup_location_id = 8 [json_name = "pickup_location_id"];
  optional string service_started_report_url = 9 [json_name = "service_started_report_url"];
  optional string service_ended_report_url = 10 [json_name = "service_ended_report_url"];
  optional uint64 route_id = 11 [json_name = "route_id"];
  optional string driver_comment = 12 [json_name = "driver_comment"];
  optional google.protobuf.Timestamp plan_start_at = 13 [json_name = "plan_start_at"];
  optional google.protobuf.Timestamp plan_end_at = 14 [json_name = "plan_end_at"];
  optional JobType type = 15 [json_name = "type"];
  optional uint64 job_tariff = 16 [json_name = "job_tariff"];
  optional bool is_pseudo = 17 [json_name = "is_pseudo"];
}

message JobUpdate {
  required uint64 id = 1 [json_name = "id"];
  optional uint64 service_provider_id = 2 [json_name = "service_provider_id"];
  optional uint64 service_receiver_id = 3 [json_name = "service_receiver_id"];
  optional google.protobuf.Timestamp tw_start_at = 4 [json_name = "tw_start_at"];
  optional google.protobuf.Timestamp tw_end_at = 5 [json_name = "tw_end_at"];
  optional uint64 step_idx = 6 [json_name = "step_idx"];
  optional uint64 driver_on_shift_id = 7 [json_name = "driver_on_shift_id"];
  optional uint64 pickup_location_id = 8 [json_name = "pickup_location_id"];
  optional string service_started_report_url = 9 [json_name = "service_started_report_url"];
  optional string service_ended_report_url = 10 [json_name = "service_ended_report_url"];
  optional uint64 route_id = 11 [json_name = "route_id"];
  optional string driver_comment = 12 [json_name = "driver_comment"];
  optional google.protobuf.Timestamp plan_start_at = 13 [json_name = "plan_start_at"];
  optional google.protobuf.Timestamp plan_end_at = 14 [json_name = "plan_end_at"];
  optional google.protobuf.Timestamp fact_start_at = 15 [json_name = "fact_start_at"];
  optional google.protobuf.Timestamp fact_end_at = 16 [json_name = "fact_end_at"];
  optional JobStatus status = 17 [json_name = "status"];
  optional JobType type = 18 [json_name = "type"];
  optional DispatcherReviewStatus dispatcher_review_status = 19 [json_name = "dispatcher_review_status"];
  optional double service_start_photo_lat = 20 [json_name = "service_start_photo_lat"];
  optional double service_start_photo_lon = 21 [json_name = "service_start_photo_lon"];
  optional double service_end_photo_lat = 22 [json_name = "service_end_photo_lat"];
  optional double service_end_photo_lon = 23 [json_name = "service_end_photo_lon"];
  optional string container_name = 24 [json_name = "container_name"];
  optional uint64 job_tariff = 25 [json_name = "job_tariff"];
  optional bool is_pseudo = 26 [json_name = "is_pseudo"];
  optional google.protobuf.Timestamp gps_start_at = 28 [json_name = "gps_start_at"];
  optional google.protobuf.Timestamp gps_end_at = 29 [json_name = "gps_end_at"];
}

message JobStatusUpdate {
  required uint64 id = 1 [json_name = "id"];
  required JobStatus status = 2 [json_name = "status"];
}

message JobPickUpStart {
  required uint64 id = 1 [json_name = "id"];
}

message JobPickUpFinish {
  required uint64 id = 1 [json_name = "id"];
}

message JobList {
  repeated Job jobs = 1 [json_name = "jobs"];
}

message JobRequest {
  required uint64 job_id = 1 [json_name = "job_id"];
}
